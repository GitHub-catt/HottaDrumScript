# 幻塔鼓谱演奏工具

这是一个为热门游戏《幻塔》(Tower of Fantasy) 设计的PC端架子鼓自动演奏工具。它提供了一个简洁的图形用户界面，让玩家可以轻松管理和演奏鼓谱，甚至可以将标准的MIDI鼓点文件转换为游戏可用的乐谱格式。

作者: **花生喵酱**

## ✨ 主要功能

- **图形用户界面**：拥有直观的操作界面，所有功能一目了然。
- **乐谱管理与播放**：
  - 自动加载 `scores` 目录下的乐谱文件。
  - 提供播放、暂停、上一首、下一首等标准播放控制。
  - 支持**循环播放**和**随机变奏**模式，增加演奏的趣味性。
- **MIDI 转换**：
  - 自动扫描 `MIDI` 目录下的 MIDI 文件。
  - 一键将 MIDI 文件转换为项目兼容的 `.json` 乐谱格式。
- **跨平台**：基于 Python 和 PySide6 构建，理论上支持所有主流桌面操作系统。

## 🚀 如何使用

1.  **下载项目**：
    克隆或下载本仓库到您的本地计算机。

2.  **安装依赖**：
    在项目根目录下打开终端或命令行，运行以下命令来安装所有必需的库：
    ```bash
    pip install -r requirements.txt
    ```

3.  **运行程序**：
    继续在终端中运行：
    ```bash
    python gui.py
    ```

4.  **开始使用**：
    - **转换MIDI**：将你的 `.mid` 或 `.midi` 鼓谱文件放入项目根目录下的 `MIDI` 文件夹。切换到程序的 "MIDI" 选项卡，点击 "MIDI 转幻塔乐谱" 按钮，程序会自动完成转换。
    - **开始演奏**：切换到 "SCORES" 选项卡，双击列表中的乐谱即可开始自动演奏。请确保在演奏前已将游戏窗口置于前台。


5. **其他说明**
    - **关于 `configbackup.txt`**: 此文件保存了两套备用键位配置。第一套是《幻塔》的默认键位，第二套是为 `pianoabrsm` 适配的键位。
    - **关于乐谱转换的细节**: 
        本工具依据标准的"通用MIDI鼓点映射(GM Drum Map)"进行转换。由于标准MIDI中的鼓件远多于《幻塔》游戏内提供的鼓件，转换遵循以下原则：
        - **合并相似音符**: 功能相似的MIDI鼓点会被映射到同一个游戏内鼓件。例如，多个不同音高的MIDI通鼓（Tom）会被统一映射到游戏里的高、中、低通鼓上。
        - **忽略不支持的音符**: 对于《幻塔》中完全不存在的鼓件（如牛铃、邦哥鼓、康加鼓等），其音符会在转换过程中被忽略。
        因此，转换后的乐谱相比原始MIDI文件可能会感觉"缺少"或简化了部分音符，这是为了适配游戏内演奏而设计的正常现象。
    - **关于随机变奏**: 此功能仅对乐谱中预设了出现概率 (`probability`) 的特定音符生效，主要用于增加循环演奏时的趣味性。

## 📝 许可协议

本项目基于 [GPLv3](LICENSE) 协议开源。

---

Copyright (c) 2024 花生喵酱 